<!DOCTYPE html>
<html lang="en">
<head>
    <!-- TODO split js into separate file-->
    <meta charset="UTF-8">
    <title>159352 Portfolio</title>
    <script src="libs/require.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
</head>
<body style="text-align:center;" id="body">
<!--On this page we need the following:
A database table set up showing the current stocks.
This needs to be populated from the JSON data held in the file storage using JS?.
-->

<h1>Josh's Investment Portfolio</h1>

<!-- TODO make sure it resets the table instead of adding a new one-->
<button onclick="constructTable('#table')">
    click here
</button>

<br><br>

<table align="center"
       id="table" border="1">
</table>

<script>
    // const fs = require('fs');
    // TODO Here we need to get the JSON data from the file
    let list = [
        {"Stock": "AAPL", "Quantity": "100", "Price": "20", "Gain/Loss": "-20%"},
        {"Stock": "GME", "Quantity": "50", "Price": "10", "Gain/Loss": "1%"},
        {"Stock": "TSLA", "Quantity": "33", "Price": "5", "Gain/Loss": "12%"}
    ];

    function constructTable(selector) {

        // Getting the all column names
        let cols = Headers(list, selector);

        // Traversing the JSON data
        for (let i = 0; i < list.length; i++) {
            let row = $('<tr/>');
            for (let colIndex = 0; colIndex < cols.length; colIndex++) {
                let val = list[i][cols[colIndex]];

                // If there is any key, which is matching
                // with the column name
                if (val == null) val = "";
                row.append($('<td/>').html(val));
            }

            // Adding each row to the table
            $(selector).append(row);
        }
    }

    function Headers(list, selector) {
        let columns = [];
        let header = $('<tr/>');

        for (let i = 0; i < list.length; i++) {
            let row = list[i];

            for (let k in row) {
                if ($.inArray(k, columns) === -1) {
                    columns.push(k);

                    // Creating the header
                    header.append($('<th style="width:120px"/>').html(k));
                }
            }
        }

        // Appending the header to the table
        $(selector).append(header);
        return columns;
    }
</script>
</body>
</html>